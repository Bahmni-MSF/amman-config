<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="Amman-01" author="Chethan" context="rel1">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'emr.personImagesDirectory'
            </sqlCheck>
        </preConditions>
        <comment>Set up person image directory</comment>
        <sql>
            select uuid() into @uuid;
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('emr.personImagesDirectory',
            '/home/bahmni/patient_images',
            'Location of patient images - required by emrapi',
            @uuid
            );
        </sql>
    </changeSet>
    <changeSet id="Amman-183504102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whose are in first stage date of file recieved filled and date of presentation is not filled</comment>
        <sqlFile path="awaitingValidationPatientQueue.sql"/>
    </changeSet>
    <changeSet id="Amman-183604102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whos expected date of arrival is filled and arrival date not filled</comment>
        <sqlFile path="expectedarrivalpatientqueue.sql"/>
    </changeSet>
    <changeSet id="Amman-113006102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whose program state is network-followup and date of presentation in followup is not filled</comment>
        <sqlFile path="awaitingValidationfollowup.sql"/>
    </changeSet>
    <changeSet id="Amman-165112102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whose medical file is not complete</comment>
        <sqlFile path="incompleteMedicalFile.sql"/>
    </changeSet>
    <changeSet id="Amman-103414102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients who are in under follow-Up validation</comment>
        <sqlFile path="continueUnderFollowup.sql"/>
    </changeSet>
    <changeSet id="Amman-150614102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients who are filled with date of presentation and with outcome as postponed or need more information</comment>
        <sqlFile path="MoreInformationorPostponed.sql"/>
    </changeSet>
    <changeSet id="Amman-113620102016" author="Shiva kumar, Santhosh" context="rel1">
        <comment>Adding a procedure to create a concept reference mapping</comment>
        <sql>
            DROP PROCEDURE IF EXISTS CREATE_REFERENCE_MAPPING;
        </sql>
        <sqlFile splitStatements="false" path="CreateReferenceMapping.sql"/>
    </changeSet>
    <changeSet id="Amman-113920102016" author="Shiva kumar, Santhosh" context="rel1">
        <comment>Adding reference terms for CEIL exports codes</comment>
        <sqlFile path="export_ref_terms.sql"/>
    </changeSet>
    <changeSet id="Amman-114020102016" author="Shiva Kumar, Santhosh" context="rel1">
        <comment>Mapping export codes with respective concepts</comment>
        <sqlFile path="concept_ref_map.sql"/>
    </changeSet>
    <changeSet id="Amman-201612051834" author="Santhosh, Kaustav" context="rel2.2" runOnChange="true">
        <comment>Adding patient listing queue for adt toAdmit</comment>
        <sqlFile path="adtPatientsToAdmit.sql"/>
    </changeSet>
    <changeSet id="Amman-11406122016" author="Sourav" context="rel2.2" runOnChange="true">
        <comment>Updating the property emrapi.sqlSearch.admittedPatients</comment>
        <sqlFile path="adtAdmittedQueue.sql"/>
    </changeSet>
     <changeSet id="Amman-114707122016" author="Shiva kumar" context="rel2.1" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_set where concept_id=840 and concept_set=409;
            </sqlCheck>
        </preConditions>
        <comment>Adding video upload and date of presentation in final validation form</comment>
        <sql>
            INSERT INTO concept_set(concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (840,409,0,8,now(),uuid()),(835,409,1,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-130613122016" author="shiva kumar" context="rel2.1" runOnChange="true">
        <comment>Updating Final Validation form fields in given format</comment>
        <sql>
            UPDATE concept_set SET sort_weight=0 WHERE concept_id=840 and concept_set=409;
            UPDATE concept_set SET sort_weight=1 WHERE concept_id=835 and concept_set=409;
            UPDATE concept_set SET sort_weight=2 WHERE concept_id=282 and concept_set=409;
            UPDATE concept_set SET sort_weight=3 WHERE concept_id=417 and concept_set=409;
            UPDATE concept_set SET sort_weight=4 WHERE concept_id=291 and concept_set=409;
            UPDATE concept_set SET sort_weight=5 WHERE concept_id=295 and concept_set=409;
            UPDATE concept_set SET sort_weight=6 WHERE concept_id=297 and concept_set=409;
        </sql>
    </changeSet>
    <changeSet id="Amman-120212122016" author="Shiva kumar" context="rel2.1" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_answer where concept_id=282 and answer_concept=836;
            </sqlCheck>
        </preConditions>
        <comment>Adding Answer concepts to Outcome in Final Validation Form</comment>
        <sql>
            INSERT INTO concept_answer (concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (282,836,8,now(),4,uuid()),
            (282,837,8,now(),5,uuid()),
            (282,838,8,now(),6,uuid()),
            (282,839,8,now(),7,uuid());
        </sql>
    </changeSet>
</databaseChangeLog>