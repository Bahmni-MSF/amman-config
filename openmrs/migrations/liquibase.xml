<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="Amman-01" author="Chethan" context="rel1">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'emr.personImagesDirectory'
            </sqlCheck>
        </preConditions>
        <comment>Set up person image directory</comment>
        <sql>
            select uuid() into @uuid;
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('emr.personImagesDirectory',
            '/home/bahmni/patient_images',
            'Location of patient images - required by emrapi',
            @uuid
            );
        </sql>
    </changeSet>
    <changeSet id="Amman-201703211715" author="Santhosh, Maharjun" runOnChange="true">
        <comment>Updating the program active patients listing queue</comment>
        <sqlFile path="programsActivePatientsQueue.sql"/>
    </changeSet>
    <changeSet id="Amman-183504102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whose are in first stage date of file recieved filled and date of presentation is not filled</comment>
        <sqlFile path="awaitingValidationPatientQueue.sql"/>
    </changeSet>
    <changeSet id="Amman-183604102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whos expected date of arrival is filled and arrival date not filled</comment>
        <sqlFile path="expectedarrivalpatientqueue.sql"/>
    </changeSet>
    <changeSet id="Amman-113006102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whose program state is network-followup and date of presentation in followup is not filled</comment>
        <sqlFile path="awaitingValidationfollowup.sql"/>
    </changeSet>
    <changeSet id="Amman-165112102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients whose medical file is not complete</comment>
        <sqlFile path="incompleteMedicalFile.sql"/>
    </changeSet>
    <changeSet id="Amman-103414102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients who are in under follow-Up validation</comment>
        <sqlFile path="continueUnderFollowup.sql"/>
    </changeSet>
    <changeSet id="Amman-150614102016" author="Shiva kumar" context="rel1" runOnChange="true">
        <comment>Adding patient listing queues for patients who are filled with date of presentation and with outcome as postponed or need more information</comment>
        <sqlFile path="MoreInformationorPostponed.sql"/>
    </changeSet>
    <changeSet id="Amman-113620102016" author="Shiva kumar, Santhosh" context="rel1">
        <comment>Adding a procedure to create a concept reference mapping</comment>
        <sql>
            DROP PROCEDURE IF EXISTS CREATE_REFERENCE_MAPPING;
        </sql>
        <sqlFile splitStatements="false" path="CreateReferenceMapping.sql"/>
    </changeSet>
    <changeSet id="Amman-113920102016" author="Shiva kumar, Santhosh" context="rel1">
        <comment>Adding reference terms for CEIL exports codes</comment>
        <sqlFile path="export_ref_terms.sql"/>
    </changeSet>
    <changeSet id="Amman-114020102016" author="Shiva Kumar, Santhosh" context="rel1">
        <comment>Mapping export codes with respective concepts</comment>
        <sqlFile path="concept_ref_map.sql"/>
    </changeSet>
    <changeSet id="Amman-201612051834" author="Santhosh, Kaustav" context="rel2.2" runOnChange="true">
        <comment>Adding patient listing queue for adt toAdmit</comment>
        <sqlFile path="adtPatientsToAdmit.sql"/>
    </changeSet>
    <changeSet id="Amman-11406122016" author="Sourav" context="rel2.2" runOnChange="true">
        <comment>Updating the property emrapi.sqlSearch.admittedPatients</comment>
        <sqlFile path="adtAdmittedQueue.sql"/>
    </changeSet>
    <changeSet id="Amman-114707122016" author="Shiva kumar" context="rel2.1" runOnChange="true" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM concept_set WHERE concept_id=(SELECT concept_id  FROM concept_name WHERE name = 'FV, Patient Videos' AND concept_name_type="FULLY_SPECIFIED") AND concept_set=409;
            </sqlCheck>
        </preConditions>
        <comment>Adding video upload and date of presentation in final validation form</comment>
        <sql>
            SELECT concept_id INTO @concept_id1 FROM concept_name WHERE name = 'FV, Patient Videos' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set(concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id1,409,0,8,now(),uuid());
            SELECT concept_id INTO @concept_id2 FROM concept_name where name = 'FV, Date of Presentation' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set(concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id2,409,0,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-130613122016" author="shiva kumar" context="rel2.1" runOnChange="true">
        <comment>Updating Final Validation form fields in given format</comment>
        <sql>
            select concept_id into @concept_id1 from concept_name where name = 'FV, Patient Videos' AND concept_name_type="FULLY_SPECIFIED";
            select concept_id into @concept_id2 from concept_name where name = 'FV, Date of Presentation' AND concept_name_type="FULLY_SPECIFIED";
            select concept_id into @concept_id3 from concept_name where name = 'FV, Outcomes FV' AND concept_name_type="FULLY_SPECIFIED";
            select concept_id into @concept_id4 from concept_name where name = 'FV, Comments on FV' AND concept_name_type="FULLY_SPECIFIED";
            select concept_id into @concept_id5 from concept_name where name = 'FV, Expected Date of Arrival' AND concept_name_type="FULLY_SPECIFIED";
            select concept_id into @concept_id6 from concept_name where name = 'FV, Does the Patient need Accommodation?' AND concept_name_type="FULLY_SPECIFIED";
            select concept_id into @concept_id7 from concept_name where name = 'FV, Type of Admission Recommended' AND concept_name_type="FULLY_SPECIFIED";
            UPDATE concept_set SET sort_weight=0 WHERE concept_id=@concept_id1 and concept_set=409;
            UPDATE concept_set SET sort_weight=1 WHERE concept_id=@concept_id2 and concept_set=409;
            UPDATE concept_set SET sort_weight=2 WHERE concept_id=@concept_id3 and concept_set=409;
            UPDATE concept_set SET sort_weight=3 WHERE concept_id=@concept_id4 and concept_set=409;
            UPDATE concept_set SET sort_weight=4 WHERE concept_id=@concept_id5 and concept_set=409;
            UPDATE concept_set SET sort_weight=5 WHERE concept_id=@concept_id6 and concept_set=409;
            UPDATE concept_set SET sort_weight=6 WHERE concept_id=@concept_id7 and concept_set=409;
        </sql>
    </changeSet>
    <changeSet id="Amman-120212122016" author="Shiva kumar" context="rel2.1" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
            select count(*) from concept_answer where answer_concept=(SELECT concept_id FROM concept_name WHERE name = 'R2A : Surgery Outside' AND concept_name_type="FULLY_SPECIFIED") and concept_id=835;
            </sqlCheck>
        </preConditions>
        <comment>Adding Answer concepts to Outcome in Final Validation Form</comment>
        <sql>
            SELECT concept_id INTO @concept_id1 FROM concept_name WHERE name = 'R2A : Surgery Outside' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_answer (concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (282,@concept_id1,8,now(),4,uuid());
            SELECT concept_id INTO @concept_id2 FROM concept_name where name = 'R2B: Refused Treatment or Follow-up' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_answer (concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES   (282,@concept_id2,8,now(),6,uuid());
            SELECT concept_id INTO @concept_id3 FROM concept_name where name = 'R2C: refused to travel to Amman' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_answer (concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES   (282,@concept_id3,8,now(),7,uuid());
            SELECT concept_id INTO @concept_id4 FROM concept_name where name = 'R2D: Refused to Under Surgery' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_answer (concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES   (282,@concept_id4,8,now(),8,uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201612181609" author="Shiva kumar" context="rel2.1" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM concept_set WHERE concept_id=(SELECT concept_id  FROM concept_name WHERE name = 'Orthopantogram (OPG)') AND concept_set=754;
            </sqlCheck>
        </preConditions>
        <comment>Adding concepts in patient document upload </comment>
        <sql>
            SELECT concept_id INTO @concept_id1 FROM concept_name WHERE name = 'Orthopantogram (OPG)';
            insert into concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) values (@concept_id1,754,12,8,now(),uuid());
            SELECT concept_id INTO @concept_id2 FROM concept_name WHERE name = 'Electrocardiogram (ECG)';
            insert into concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) values (@concept_id2,754,13,8,now(),uuid());
            SELECT concept_id INTO @concept_id3 FROM concept_name WHERE name = 'Blood Investigations';
            insert into concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) values (@concept_id3,754,14,8,now(),uuid());
            SELECT concept_id INTO @concept_id4 FROM concept_name WHERE name = 'Cardiac Echo';
            insert into concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) values (@concept_id4,754,15,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201612201052" author="Shiva kumar" context="rel2.1" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT count(*) FROM concept_answer WHERE answer_concept=(SELECT concept_id FROM concept_name WHERE name = 'Orthopedic + Plastic' AND concept_name_type="FULLY_SPECIFIED") AND concept_id=(SELECT concept_id FROM concept_name WHERE name ="FSTG, Specialty determined by MLO");
            </sqlCheck>
        </preConditions>
        <comment>Deleting answer concepts from Specialty in first stage validation form </comment>
        <sql>
            SELECT concept_id INTO @concept_id1 FROM concept_name WHERE name = 'Orthopedic + Plastic' AND concept_name_type="FULLY_SPECIFIED";
            delete from concept_answer where answer_concept=@concept_id1 and concept_id=(SELECT concept_id FROM concept_name WHERE name ="FSTG, Specialty determined by MLO");
            SELECT concept_id INTO @concept_id2 FROM concept_name WHERE name = 'Orthopedic + Maxillofacial' AND concept_name_type="FULLY_SPECIFIED";
            delete from concept_answer where answer_concept=@concept_id2 and concept_id=(SELECT concept_id FROM concept_name WHERE name ="FSTG, Specialty determined by MLO");
            SELECT concept_id INTO @concept_id3 FROM concept_name WHERE name = 'Plastic + Maxillofacial' AND concept_name_type="FULLY_SPECIFIED";
            delete from concept_answer where answer_concept=@concept_id3 and concept_id=(SELECT concept_id FROM concept_name WHERE name ="FSTG, Specialty determined by MLO");
            SELECT concept_id INTO @concept_id4 FROM concept_name WHERE name = 'Orthopedic + Plastic + Maxillofacial' AND concept_name_type="FULLY_SPECIFIED";
            delete from concept_answer where answer_concept=@concept_id4 and concept_id=(SELECT concept_id FROM concept_name WHERE name ="FSTG, Specialty determined by MLO");
        </sql>
    </changeSet>
    <changeSet id="Amman-201612291240" author="Shiva kumar" context="rel2.1" runOnChange="true">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM concept_answer WHERE answer_concept=(SELECT concept_id FROM concept_name WHERE name = 'Other' AND concept_name_type="FULLY_SPECIFIED") AND concept_id=(SELECT concept_id FROM concept_name WHERE name ="camp");
            </sqlCheck>
        </preConditions>
        <comment>Adding other concept in camps and comments in camp </comment>
        <sql>
            SELECT concept_id INTO @conceptid1 FROM concept_name where name ="Other" and concept_name_type = "FULLY_SPECIFIED";
            SELECT concept_id INTO @conceptid2 FROM concept_name where name ="camp" and concept_name_type = "FULLY_SPECIFIED";
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@conceptid2,@conceptid1,1,now(),3,uuid());
            Insert into  person_attribute_type (name ,description ,format, creator,date_created,sort_weight,uuid) values ("campComments","Comments","java.lang.String",1,now(),64,uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201701251215" author="Santhosh, Swarup" context="rel2.1">
        <comment>Migrating the consultation encounters that were part of clinical to programs</comment>
        <sqlFile path="migrateClinicalEncountersToProgram.sql"/>
    </changeSet>
             <changeSet id="Amman-201612281718" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from concept_set where concept_id in (select concept_id from concept_name where name ="Baseline Vital Signs" and concept_name_type = "FULLY_SPECIFIED") and concept_set =88;
            </sqlCheck>
        </preConditions>
        <comment>Adding new observation templates </comment>
        <sql>
            SELECT concept_id INTO @concept_id1 FROM concept_name WHERE name = 'Baseline Vital Signs' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id1,88,4,8,now(),uuid());
            SELECT concept_id INTO @concept_id2 FROM concept_name WHERE name = 'Social AND Medical History' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id2,88,5,8,now(),uuid());
            SELECT concept_id INTO @concept_id3 FROM concept_name WHERE name = 'Health Education' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id3,88,6,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201701181528" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from concept_set where concept_id in (select concept_id from concept_name where name ="Initial Anesthesia Assessment" and concept_name_type = "FULLY_SPECIFIED") and concept_set =88;
            </sqlCheck>
        </preConditions>
        <comment>Adding new observation templates </comment>
        <sql>
            SELECT concept_id INTO @concept_id4 FROM concept_name WHERE name = 'Initial Anesthesia Assessment' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id4,88,7,8,now(),uuid());
            SELECT concept_id INTO @concept_id5 FROM concept_name WHERE name = 'Physiotherapy initial assessment' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id5,88,8,8,now(),uuid());
            SELECT concept_id INTO @concept_id6 FROM concept_name WHERE name = 'Psychology initial assessment' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id6,88,9,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201702091422" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from concept_set where concept_id in (select concept_id from concept_name where name ="Surgeon Pre-Op Assessment and Treatment Plan" and concept_name_type = "FULLY_SPECIFIED") and concept_set =88;
            </sqlCheck>
        </preConditions>
        <comment>Adding new observation templates </comment>
        <sql>
            SELECT concept_id INTO @concept_id7 FROM concept_name WHERE name = 'MD Initial Assessment' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id7,88,10,8,now(),uuid());
            SELECT concept_id INTO @concept_id8 FROM concept_name WHERE name = 'Surgeon Pre-Op Assessment and Treatment Plan' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id8,88,11,8,now(),uuid());

        </sql>
    </changeSet>
    <changeSet id="Amman-201703131208" author="Shiva kumar">
        <comment>Deleting all bed location tags and bed location maps</comment>
        <sqlFile path="bedManagement/clearBedLayout.sql"/>
    </changeSet>
    <changeSet id="Amman-201703131210" author="Shiva kumar">
        <comment>Adding All Parent and child Bed locations</comment>
        <sqlFile path="bedManagement/addLocationsforBedLayouts.sql"/>
    </changeSet>
    <changeSet id="Amman-201703131539" author="Shiva kumar, David">
        <comment>Stored Procedure to insert beds into locations</comment>
        <sqlFile path="bedManagement/insertBedIntoLocationStoredProcedure.sql" endDelimiter="#"/>
    </changeSet>
    <changeSet id="Amman-201703131211" author="Shiva kumar">
        <comment>Adding bed layout to Rehabilitation Center</comment>
        <sqlFile path="bedManagement/rehabilitationBedLayout.sql"/>
    </changeSet>
    <changeSet id="Amman-201703131213" author="Shiva kumar">
        <comment>Adding bed layout to Ward</comment>
        <sqlFile path="bedManagement/wardBedLayout.sql"/>
    </changeSet>
    <changeSet id="Amman-201703131215" author="Shiva kumar">
        <comment>Adding bed layout to Hotel Kahramana</comment>
        <sqlFile path="bedManagement/kahramanaBedLayout.sql"/>
    </changeSet>
       <changeSet id="Amman-201702151757" author="Santhosh" context="rel2.3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from bed_tag;
            </sqlCheck>
        </preConditions>
        <comment>Adding bed tags</comment>
        <sql>
            INSERT INTO bed_tag(name, creator, date_created, voided, uuid) VALUES ("Lost", 1, now(), 0, uuid());
            INSERT INTO bed_tag(name, creator, date_created, voided, uuid) VALUES ("Isolation", 1, now(), 0, uuid());
            INSERT INTO bed_tag(name, creator, date_created, voided, uuid) VALUES ("Strict Isolation", 1, now(), 0, uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201702161728" author="Shiva Kumar">
        <comment>Adding Diagnosis Set of Sets in global properties</comment>
        <sql>
            DELETE FROM global_property where property = 'emr.concept.diagnosisSetOfSets';
            select uuid() into @uuid;
            select uuid into @conceptID from concept_name where name="Diagnosis Set of Sets" and concept_name_type="FULLY_SPECIFIED";
            INSERT INTO global_property (`property`, `property_value`, `description`, `uuid`)
            VALUES ('emr.concept.diagnosisSetOfSets',@conceptID,'Diagnosis Set of Sets',@uuid);
        </sql>
    </changeSet>

    <changeSet id="Amman-201702211105" author="Santhosh" context="rel2.3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from bed_tag where name = "Reserved for CT";
            </sqlCheck>
        </preConditions>
        <comment>adding new bed tag Reserved for Caretaker</comment>
        <sql>
            INSERT INTO bed_tag(name, creator, date_created, voided, uuid) VALUES ("Reserved for CT", 1, now(), 0, uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201702211500" author="Shiva Kumar">
        <comment>Deleting existing Dispositions</comment>
        <sql>
            SELECT concept_id INTO @ConceptID FROM concept_name WHERE name ="Disposition" AND concept_name_type="FULLY_SPECIFIED";
            DELETE FROM concept_answer WHERE concept_id=@conceptID;
        </sql>
    </changeSet>
    <changeSet id="Amman-201702211501" author="Shiva Kumar">
        <comment>Adding new Dispositions</comment>
        <sql>
            SELECT concept_id INTO @ConceptID FROM concept_name WHERE name ='Disposition' AND concept_name_type='FULLY_SPECIFIED';
            SELECT concept_id INTO @Disposition1 FROM concept_name WHERE name ='Admit to RC' AND concept_name_type='FULLY_SPECIFIED';
            SELECT concept_id INTO @Disposition2 FROM concept_name WHERE name ='Admit to Ward' AND concept_name_type='FULLY_SPECIFIED';
            SELECT concept_id INTO @Disposition3 FROM concept_name WHERE name ='Admit to Kahramana' AND concept_name_type='FULLY_SPECIFIED';
            SELECT concept_id INTO @Disposition4 FROM concept_name WHERE name ='Movement to Ward' AND concept_name_type='FULLY_SPECIFIED';
            SELECT concept_id INTO @Disposition5 FROM concept_name WHERE name ='Movement to RC' AND concept_name_type='FULLY_SPECIFIED';
            SELECT concept_id INTO @Disposition6 FROM concept_name WHERE name ='Movement to Kahramana' AND concept_name_type='FULLY_SPECIFIED';
            SELECT concept_id INTO @Disposition7 FROM concept_name WHERE name ='Transfer Home' AND concept_name_type='FULLY_SPECIFIED';
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@ConceptID,@Disposition1,1,now(),0,uuid());
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@ConceptID,@Disposition2,1,now(),1,uuid());
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@ConceptID,@Disposition3,1,now(),2,uuid());
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@ConceptID,@Disposition4,1,now(),3,uuid());
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@ConceptID,@Disposition5,1,now(),4,uuid());
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@ConceptID,@Disposition6,1,now(),5,uuid());
            INSERT INTO concept_answer(concept_id,answer_concept,creator,date_created,sort_weight,uuid) VALUES (@ConceptID,@Disposition7,1,now(),6,uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201702171623" author="Shiva kumar" runOnChange="true">
        <comment>Bed management patient listing queues for RC, Ward, Kahramana</comment>
        <sqlFile path="bedManagement/patientsAdmittoRc.sql"/>
        <sqlFile path="bedManagement/patientsAdmittoWard.sql"/>
        <sqlFile path="bedManagement/patientsadmitttokahramana.sql"/>
        <sqlFile path="bedManagement/PatientsMovementtoKahramana.sql"/>
        <sqlFile path="bedManagement/patientsMovementtoRc.sql"/>
        <sqlFile path="bedManagement/PatientsMovementtoWard.sql"/>
        <sqlFile path="bedManagement/PatientsTransferHome.sql"/>
    </changeSet>
    <changeSet id="Amman-201702221345" author="Shireesha">
        <comment>Adding new add_concept procedure</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_concept;
        </sql>
        <sqlFile splitStatements="false" path="E1_1__AddConceptProc.sql"/>
    </changeSet>
    <changeSet id="Amman-201702241601" author="Shireesha" context="rel2.3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from concept_set cs where cs.concept_set in (SELECT concept_id from concept_name where name = 'IPD Expected DD' and concept_name_type="FULLY_SPECIFIED");
            </sqlCheck>
        </preConditions>
        <comment>Adding the concepts for expected date of discharge</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @concept_datatype_coded = 0;
            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'IPD Expected DD', 'IPD Expected DD', 'N/A', 'misc', true);

            set @child1_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @concept_datatype_coded = 0;
            call add_concept(@child1_concept_id, @concept_name_short_id, @concept_name_full_id, 'Expected Date of Discharge', 'Expected Date of Discharge', 'Date', 'misc', false);

            set @child2_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @concept_datatype_coded = 0;
            call add_concept(@child2_concept_id, @concept_name_short_id, @concept_name_full_id, 'Reason for Change in EDD', 'Reason for Change in EDD', 'Text', 'misc', false);

            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@child1_concept_id,@concept_id,1,8,now(),uuid());
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@child2_concept_id,@concept_id,1,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201702271852" author="Shiva kumar">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from program_workflow_state where concept_id = (select concept_id from concept_name where name="Surgical" and concept_name_type="FULLY_SPECIFIED");
            </sqlCheck>
        </preConditions>
        <comment>Adding new work flow states</comment>
        <sql>
            select concept_id into @workflow1 from concept_name where name="Surgical" and concept_name_type="FULLY_SPECIFIED";
            Insert into program_workflow_state(program_workflow_id,concept_id,creator,date_created,uuid) values (2,@workflow1,8,now(),uuid());
            select concept_id into @workflow2 from concept_name where name="Pre-Operative" and concept_name_type="FULLY_SPECIFIED";
            Insert into program_workflow_state(program_workflow_id,concept_id,creator,date_created,uuid) values (2,@workflow2,8,now(),uuid());
            select concept_id into @workflow3 from concept_name where name="Rehabilitation" and concept_name_type="FULLY_SPECIFIED";
            Insert into program_workflow_state(program_workflow_id,concept_id,creator,date_created,uuid) values (2,@workflow3,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201702281640" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from concept_set where concept_id in (select concept_id from concept_name where name ="Physical Examination" and concept_name_type = "FULLY_SPECIFIED") and concept_set =88;
            </sqlCheck>
        </preConditions>
        <comment>Adding new observation templates </comment>
        <sql>
            SELECT concept_id INTO @concept_id1 FROM concept_name WHERE name = 'Physical Examination' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id1,88,12,8,now(),uuid());

        </sql>
    </changeSet>
    <changeSet id="Amman-201703100949450" author="David Oh" runOnChange="true">
        <comment>Updating SQL query for Bed Management List View</comment>
        <sqlFile path="bedManagement/PatientWardDetails.sql"/>
    </changeSet>
    <changeSet id="Amman-201703151717" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from concept_set where concept_id in (select concept_id from concept_name where name ="OBS, Surgical Diagnoses" and concept_name_type = "FULLY_SPECIFIED") and concept_set =88;
            </sqlCheck>
        </preConditions>
        <comment>Adding new observation templates </comment>
        <sql>
            SELECT concept_id INTO @concept_id1 FROM concept_name WHERE name = 'OBS, Surgical Diagnoses' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id1,88,13,8,now(),uuid());
            SELECT concept_id INTO @concept_id2 FROM concept_name WHERE name = 'OBS, Medical Diagnoses' AND concept_name_type="FULLY_SPECIFIED";
            INSERT INTO concept_set (concept_id,concept_set,sort_weight,creator,date_created,uuid) VALUES (@concept_id2,88,14,8,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201703231212" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from visit_type where name = "Hospital";
            </sqlCheck>
        </preConditions>
        <comment>Adding new Visit type</comment>
        <sql>
            INSERT INTO visit_type (name,description,creator,date_created,uuid) VALUES ("Hospital","Hospital visit type",1,now(),uuid());
        </sql>
    </changeSet>
    <changeSet id="Amman-201703230227" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location where name ="OPD Pre-OP";
            </sqlCheck>
        </preConditions>
        <comment>Adding OPD Pre-OP Location  </comment>
        <sql>
            SELECT location_id INTO @locationID FROM location where name = 'Al Mowasah Hospital' and description = 'Al Mowasah Hospital';
            INSERT INTO location (name, description, retired, uuid, date_created, creator, parent_location) VALUES ('OPD Pre-OP', 'OPD Pre-OP', FALSE, uuid(), NOW(), 1, @locationID);
            SELECT location_tag_id INTO @location_tagID1 FROM location_tag WHERE name = 'Login Location' and description = 'When a user logs in and chooses a session location, they may only choose one with this tag';
            SELECT location_id INTO @location_ID1 FROM location WHERE location.name='OPD Pre-OP' and description = 'OPD Pre-OP';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_ID1, @location_tagID1);
        </sql>
    </changeSet>
    <changeSet id="Amman-201703230235" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location where name ="Physiotherapy";
            </sqlCheck>
        </preConditions>
        <comment>Adding Physiotherapy Location </comment>
        <sql>
            SELECT location_id INTO @locationID FROM location where name = 'Al Mowasah Hospital' and description = 'Al Mowasah Hospital';
            INSERT INTO location (name, description, retired, uuid, date_created, creator, parent_location) VALUES ('Physiotherapy', 'Physiotherapy', FALSE, uuid(), NOW(), 1, @locationID);
            SELECT location_tag_id INTO @location_tagID1 FROM location_tag WHERE name = 'Login Location' and description = 'When a user logs in and chooses a session location, they may only choose one with this tag';
            SELECT location_id INTO @location_ID1 FROM location WHERE location.name='Physiotherapy' and description = 'Physiotherapy';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_ID1, @location_tagID1);
        </sql>
    </changeSet>
    <changeSet id="Amman-201703230237" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location where name ="Psycho-Social, Mental Health";
            </sqlCheck>
        </preConditions>
        <comment>Adding Psycho-Social, Mental Health Location </comment>
        <sql>
            SELECT location_id INTO @locationID FROM location where name = 'Al Mowasah Hospital' and description = 'Al Mowasah Hospital';
            INSERT INTO location (name, description, retired, uuid, date_created, creator, parent_location) VALUES ('Psycho-Social, Mental Health', 'Psycho-Social, Mental Health', FALSE, uuid(), NOW(), 1, @locationID);
            SELECT location_tag_id INTO @location_tagID1 FROM location_tag WHERE name = 'Login Location' and description = 'When a user logs in and chooses a session location, they may only choose one with this tag';
            SELECT location_id INTO @location_ID1 FROM location WHERE location.name='Psycho-Social, Mental Health' and description = 'Psycho-Social, Mental Health';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_ID1, @location_tagID1);
        </sql>
    </changeSet>
    <changeSet id="Amman-201703230240" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location where name ="Surgical Ward";
            </sqlCheck>
        </preConditions>
        <comment>Adding Surgical Ward Location </comment>
        <sql>
            SELECT location_id INTO @locationID FROM location where name = 'Al Mowasah Hospital' and description = 'Al Mowasah Hospital';
            INSERT INTO location (name, description, retired, uuid, date_created, creator, parent_location) VALUES ('Surgical Ward', 'Surgical Ward', FALSE, uuid(), NOW(), 1, @locationID);
            SELECT location_tag_id INTO @location_tagID1 FROM location_tag WHERE name = 'Login Location' and description = 'When a user logs in and chooses a session location, they may only choose one with this tag';
            SELECT location_id INTO @location_ID1 FROM location WHERE location.name='Surgical Ward' and description = 'Surgical Ward';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_ID1, @location_tagID1);
        </sql>
    </changeSet>
    <changeSet id="Amman-201703230241" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location where name ="Operating Theatre";
            </sqlCheck>
        </preConditions>
        <comment>Adding Operating Theatre Location </comment>
        <sql>
            SELECT location_id INTO @locationID FROM location where name = 'Al Mowasah Hospital' and description = 'Al Mowasah Hospital';
            INSERT INTO location (name, description, retired, uuid, date_created, creator, parent_location) VALUES ('Operating Theatre', 'Operating Theatre', FALSE, uuid(), NOW(), 1, @locationID);
            SELECT location_tag_id INTO @location_tagID1 FROM location_tag WHERE name = 'Login Location' and description = 'When a user logs in and chooses a session location, they may only choose one with this tag';
            SELECT location_id INTO @location_ID1 FROM location WHERE location.name='Operating Theatre' and description = 'Operating Theatre';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_ID1, @location_tagID1);
        </sql>
    </changeSet>
    <changeSet id="Amman-201703230247" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location where name ="Operating Theatre";
            </sqlCheck>
        </preConditions>
        <comment>Adding Operating Theatre Location </comment>
        <sql>
            SELECT location_id INTO @locationID FROM location where name = 'Al Mowasah Hospital' and description = 'Al Mowasah Hospital';
            INSERT INTO location (name, description, retired, uuid, date_created, creator, parent_location) VALUES ('Operating Theatre', 'Operating Theatre', FALSE, uuid(), NOW(), 1, @locationID);
            SELECT location_tag_id INTO @location_tagID1 FROM location_tag WHERE name = 'Login Location' and description = 'When a user logs in and chooses a session location, they may only choose one with this tag';
            SELECT location_id INTO @location_ID1 FROM location WHERE location.name='Operating Theatre' and description = 'Operating Theatre';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_ID1, @location_tagID1);
        </sql>
    </changeSet>
    <changeSet id="Amman-201703230250" author="Shiva kumar" context="rel2.3" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location where name ="OPD Follow-up";
            </sqlCheck>
        </preConditions>
        <comment>Adding OPD Follow-up Location </comment>
        <sql>
            SELECT location_id INTO @locationID FROM location where name = 'Al Mowasah Hospital' and description = 'Al Mowasah Hospital';
            INSERT INTO location (name, description, retired, uuid, date_created, creator, parent_location) VALUES ('OPD Follow-up', 'OPD Follow-up', FALSE, uuid(), NOW(), 1, @locationID);
            SELECT location_tag_id INTO @location_tagID1 FROM location_tag WHERE name = 'Login Location' and description = 'When a user logs in and chooses a session location, they may only choose one with this tag';
            SELECT location_id INTO @location_ID1 FROM location WHERE location.name='OPD Follow-up' and description = 'OPD Follow-up';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_ID1, @location_tagID1);
        </sql>
    </changeSet>
</databaseChangeLog>